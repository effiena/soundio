<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='picture/soundiologo.png') }}">
<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">

<link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='picture/soundiologo.png') }}">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Soundio">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>SOUNDIO</title>

<style>
body { background:#f5e895; font-family:Montserrat,sans-serif; margin:20; text-align:center; }
h1 { background:#464545; color:#E6C229; margin:10; padding:15px; }
#playlist { list-style:none; padding:0; margin:10px; max-height:220px; overflow-y:auto; }
#playlist li { padding:10px; cursor:pointer; border-bottom:1px solid #777853; }
#playlist li:hover { background:#EBD671; }
#playlist li.active { background:#78784f; color:#E6C229; font-weight:bold; }
.player-container { margin-top:15px; }
audio { display:block; width:90%; margin:10px auto; }
button { background:#656648; color:#F4F1DE; border:none; padding:10px 16px; margin:5px; border-radius:6px; cursor:pointer; }
button:hover { background:#8c9352; }

#soundio-logo {
    width: 110px;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid yellow; /* base border */
    box-shadow: 0 0 10px rgba(230,194,41,0.5); /* base glow */
    transition: transform 0.05s linear, box-shadow 0.05s linear;
    position: relative;
    z-index: 1;
}

/* glowing wave pseudo-element */
#soundio-logo::after {
    content: '';
    position: absolute;
    top: -6px; left: -6px; right: -6px; bottom: -6px;
    border-radius: 50%;
    border: 3px solid black;
    box-shadow: 0 0 10px yellow, 0 0 20px yellow, 0 0 30px yellow;
    z-index: -1;
}


@keyframes pulseWave {
    0% {
        transform: scale(1);
        opacity: 0.7;
        box-shadow: 0 0 10px yellow, 0 0 20px yellow, 0 0 30px yellow;
    }
    50% {
        transform: scale(1.1);
        opacity: 0.85;
        box-shadow: 0 0 20px yellow, 0 0 30px yellow, 0 0 40px yellow;
    }
    100% {
        transform: scale(1.2);
        opacity: 1;
        box-shadow: 0 0 30px yellow, 0 0 40px yellow, 0 0 50px yellow;
    }
}

#current-song-container {
 width:90%; overflow:hidden; white-space:nowrap; margin:10px auto;
 border-radius:6px; background:#E6C229; padding:8px 12px; text-align:left;
}

#current-song {
 font-weight:bold; font-size:18px; color:#000;
 white-space:nowrap; display:inline-block;
}

@keyframes scroll {
 0%{transform:translateX(100%);}
 100%{transform:translateX(-100%);}
}

    #soundio-logo::after {
    content: '';
    position: absolute;
    top: -6px; left: -6px; right: -6px; bottom: -6px;
    border-radius: 50%;
    border: 3px solid black;
    transform: scale(var(--wave-scale,1));
    box-shadow: 0 0 calc(var(--wave-glow,10px)) yellow, 0 0 calc(var(--wave-glow,20px)) yellow, 0 0 calc(var(--wave-glow,30px)) yellow;
    z-index: -1;
}
#logo-container { text-align:center; margin-top:15px; }

#soundio-logo {
 width:110px;
 aspect-ratio:1/1;
 border-radius:50%;
 object-fit:cover;
 box-shadow:0 0 10px rgba(230,194,41,0.5);
 transition: transform 0.05s linear, box-shadow 0.05s linear;
}
</style>
</head>

<body>

<div id="logo-container">
<img src="{{ url_for('static', filename='picture/soundiologo.png') }}" id="soundio-logo">
</div>

<h1>üé∂ SOUNDIO üé∂</h1>

<div id="current-song-container">
<span id="current-song">üéµ Select a song to play üéµ</span>
</div>

<ul id="playlist">
{% for song in playlist %}
<li data-src="{{ url_for('static', filename='music/' ~ song|urlencode) }}">{{ song }}</li>
{% endfor %}
</ul>

<div class="player-container">
<audio id="player" playsinline controls></audio>

<div>
<button id="prev-btn">‚èÆ Prev</button>
<button id="play-pause-btn">‚ñ∂Ô∏è Play / ‚è∏ Pause</button>
<button id="stop-btn">‚èπ Stop</button>
<button id="next-btn">‚è≠ Next</button>
<button id="shuffle-btn">üîÄ Shuffle</button>
<button id="repeat-btn">üîÅ Repeat</button>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

const player = document.getElementById("player");
const items = Array.from(document.querySelectorAll("#playlist li"));
const playBtn = document.getElementById("play-pause-btn");
const stopBtn = document.getElementById("stop-btn");
const nextBtn = document.getElementById("next-btn");
const prevBtn = document.getElementById("prev-btn");
const shuffleBtn = document.getElementById("shuffle-btn");
const repeatBtn = document.getElementById("repeat-btn");
const titleEl = document.getElementById("current-song");
const logo = document.getElementById("soundio-logo");

let playlist = items.map(li => li.dataset.src);
let index = 0;
let isPlaying = false;
let repeat = false;

let audioCtx, analyser, source, dataArray;

function initAudio(){
 if(audioCtx) return;
 audioCtx = new (window.AudioContext || window.webkitAudioContext)();
 source = audioCtx.createMediaElementSource(player);
 analyser = audioCtx.createAnalyser();
 source.connect(analyser);
 analyser.connect(audioCtx.destination);
 analyser.fftSize = 256;
 dataArray = new Uint8Array(analyser.frequencyBinCount);
 animateLogo();
}

 /*function animateLogo(){
 if(!analyser) return;
 requestAnimationFrame(animateLogo);
 analyser.getByteFrequencyData(dataArray);
 let avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
 let scale = 0.9 + (avg/255)*0.3;
 let glow = (avg/255)*20;
 logo.style.transform = `scale(${scale})`;
 logo.style.boxShadow = `0 0 ${glow}px rgba(230,194,41,0.8)`;
}*/

function animateLogo(){
    if(!analyser) return;
    requestAnimationFrame(animateLogo);
    analyser.getByteFrequencyData(dataArray);
    let sum = 0;
    dataArray.forEach(v => sum += v);
    let avg = sum / dataArray.length;

    const logo = document.getElementById("soundio-logo");
    if(logo){
        // music-beat pulsing
        const scale = 0.9 + (avg / 255) * 0.3;
        // main glow
        const glow = (avg / 255) * 20;

        logo.style.transform = `scale(${scale})`;
        logo.style.boxShadow = `0 0 ${glow}px rgba(230,194,41,0.8)`;

        // glowing wave synced with music
        const wave = logo.querySelector('::after');
        if(logo.style.setProperty){
            const waveSize = 1 + (avg / 255) * 0.3;
            logo.style.setProperty('--wave-scale', waveSize);
            logo.style.setProperty('--wave-glow', glow);
        }
    }
}

function updateTitle(){
 const name = items[index].textContent;
 titleEl.style.animation="none";
 titleEl.textContent = "üé∂ Now Playing: " + name;

 let container = document.getElementById("current-song-container").offsetWidth;
 let textW = titleEl.scrollWidth;

 if(textW>container){
  let duration = textW/50;
  titleEl.style.animation=`scroll ${duration}s linear infinite`;
 }
}

function loadSong(i){
 initAudio();
 items.forEach(li=>li.classList.remove("active"));
 items[i].classList.add("active");
 player.src = playlist[i];
 player.play();
 isPlaying = true;
 playBtn.textContent="‚è∏";
 updateTitle();
}

function playPause(){
 if(!player.src){ loadSong(index); return; }
 if(isPlaying){
  player.pause();
  playBtn.textContent="‚ñ∂Ô∏è";
 } else {
  player.play();
  playBtn.textContent="‚è∏";
 }
 isPlaying=!isPlaying;
}

function next(){
 index = repeat ? index : (index+1)%playlist.length;
 loadSong(index);
}

function prev(){
 index = (index-1+playlist.length)%playlist.length;
 loadSong(index);
}

function shuffle(){
 for(let i=playlist.length-1;i>0;i--){
  let j=Math.floor(Math.random()*(i+1));
  [playlist[i],playlist[j]]=[playlist[j],playlist[i]];
  [items[i].dataset.src,items[j].dataset.src]=[items[j].dataset.src,items[i].dataset.src];
  [items[i].textContent,items[j].textContent]=[items[j].textContent,items[i].textContent];
 }
 index=0;
 loadSong(index);
}

items.forEach((li,i)=>{
 li.addEventListener("click",()=>{
  index=i;
  loadSong(index);
 });
});

playBtn.onclick=playPause;
stopBtn.onclick=()=>{player.pause();player.currentTime=0;isPlaying=false;playBtn.textContent="‚ñ∂Ô∏è";};
nextBtn.onclick=next;
prevBtn.onclick=prev;
shuffleBtn.onclick=shuffle;
repeatBtn.onclick=()=>{repeat=!repeat; alert("Repeat "+(repeat?"ON":"OFF"));};

player.addEventListener("ended", next);

});
</script>

</body>
</html>
